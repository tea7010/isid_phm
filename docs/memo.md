# PHMC2019データ分析チャレンジコンテスト

## データながめメモ
* センサ値が各カラムにある
* １行は１フライトのある飛行状態（レジーム？)のスナップショット
* フライト状態は６状態あるらしい
* １ファイルがそのエンジンの正常運転し始め～死亡までみたいな感じっぽい
* testは死亡までは入ってなくて、残りどれくらい持つかを予測してねということらしい
* １ファイルの行数＝総フライト数と思われる
* めっちゃ相関高いパラメータあるので、加工なり弾く必要ありそう。論文には色々特徴量作ってたぽい

## チラシの裏
* trainの各ファイルを分割して、目的変数をtrainの残フライト数というラベルにし、回帰問題に落とす
* レジームの推移などからモデル？を作る？
* フライト数を共通の時間軸として、生存時間分析のモデルをあてはめてみる
* フライト数を集計してみる
    * trainは128～378フライトが各エンジンの総フライト数で、testは21~367フライト
    * testはだいたい平均125フライトくらいで、残りのフライト数を予測する感じっぽい
    * trainの各フライト時における、残存フライト数というカラムを作ってみると、生存分析が当てはめれそう
* 生存時間分析ってどういうデータの持ち方？でどういうアウトプットなのかを理解する必要あり
    * とりあえずpythonのlifelines
    * Kaplan-Meierだと、ノンパラ（univariateモデル）なので、単一パラメータのモデルが作成される
    * trainをクラスタリングしてみて、そのクラスごとにノンパラモデル作ってみるってのもシンプルかも
    * predictでそのフライト数における、リタイアの確率（そのエンジンが死ぬまで）が出る
    * 寿命を予測するには、そのリタイア率に閾値やランダムネスを導入して、その値を下回った時点を予測寿命とするアイデア思いついた 
    * 残存フライト数？みたいなのを各行出して回帰するのか？
    * COX model, cox hazard mode, cox proportional modelなど呼び方たくさん
* まずはKMFでモデル作ってみて、そこからハザード関数と残フライトで閾値をいくつにするかを単純に決めてみる
* モデルとして回帰にするか生存分析モデルにするかと、生存分析モデルならハザード関数からRULにどう落とすかに検討の余地
* 回帰も一回出してみるのもありかも
* 隠れマルコフモデルとは？

## 方法その１
* オーソドックスに生存分析の手法を試す
    * まずはKMで単変量のモデルを作る
        * かなり保守的なモデルができた、サンプル数の比率が問題かも
        * これは結局閾値で決めるのなら単回帰とかわらないのでは？

## 方法その２
* トータルフライト数を回帰するモデルを作成して、系列データをサマライズ（楽で従来のアプローチに落とせる）
    * 特徴量としては、各レジーム別に推移みたいなのを特徴量にしてみる
    * レジーム別で時間推移の各パラメータを見てみると、終わりに近づくに連れていくつかのパラメータが右肩あがりになってることを確認。最初と最後の差分？、直近の勾配みたいなのが効くかも
        * NRc Corrected core speed rpm
        * T30 Total temprerature at HPC outlet R
        * T50 Total tempreture at LPT outlet R
        * Nc Physical core speed rpm
        * Ps30 Static pressure at HPC outlet psia
        * BPR Bypass Ratio --
        * htBleed (Bleed Enthalpy)
    * 他にもエンジン出力モードみたいなのがあるのでそれ別にも推移を見てみる
        * あまり顕著な違いは見られず
    * 特徴量として、フライトにおける特定パラメータの直線傾きを設定した
        * 最初と最後の３フライト平均による傾き
        * 最後のフライトと約５０フライト前のフライトの傾き
* 評価方法が多分よくない。全期間学習させたものを全期間あるデータで評価して、途中までしかないデータで予測したものを提出しているのが問題設定と即していないのだと思われる
    * train -> learn, validと分けて、vlaidのみtestの近似分布でカットオフを行うと評価値と同じような結果になった!

## トライログを残す方法
* PDCAを高速で回すために、記録をつけるのを自動化させたい
* データ読み込み・前処理・モデリング・内部CVの評価などを一連でひとつのpyファイルで実行する前提
* ある程度構造が決まれば、データ構造も保存して高速読み込みさせたい